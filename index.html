<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGA - SystÃ¨me Gestion Agents</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-72x72.png">
    <meta name="theme-color" content="#2c3e50">
</head>
<body>
    <!-- En-tÃªte -->
    <header class="app-header">
        <div class="header-content">
            <h1>ğŸ“‹ SYSTEME DE GESTION DES AGENTS</h1>
            <p class="subtitle" id="pageSubtitle">Menu Principal</p>
        </div>
        <div class="header-actions">
            <button id="backBtn" class="btn-icon" title="Retour" style="display:none">â†</button>
            <button id="syncBtn" class="btn-icon" title="Synchroniser">ğŸ”„</button>
            <button id="themeBtn" class="btn-icon" title="Changer thÃ¨me">ğŸŒ™</button>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="horizontal-nav" id="topNav">
        <button class="nav-tab active" data-page="menu">ğŸ  Accueil</button>
        <button class="nav-tab" data-page="agents">ğŸ‘¥ Agents</button>
        <button class="nav-tab" data-page="planning">ğŸ“… Planning</button>
        <button class="nav-tab" data-page="stats">ğŸ“Š Stats</button>
        <button class="nav-tab" data-page="radios">ğŸ“» Radios</button>
        <button class="nav-tab" data-page="panique">ğŸš¨ Panique</button>
        <button class="nav-tab" data-page="habillement">ğŸ‘• Habillement</button>
        <button class="nav-tab" data-page="avertissements">âš ï¸ Avertissements</button>
        <button class="nav-tab" data-page="conges">ğŸ–ï¸ CongÃ©s</button>
        <button class="nav-tab" data-page="outils">ğŸ› ï¸ Outils</button>
    </nav>

    <!-- Contenu principal -->
    <main class="main-content">
        <div id="pageMenu" class="page active">
            <div class="menu-grid"></div>
        </div>
        <div id="pageAgents" class="page"><div class="page-content" id="agentsContent"></div></div>
        <div id="pagePlanning" class="page"><div class="page-content" id="planningContent"></div></div>
        <div id="pageStats" class="page"><div class="page-content" id="statsContent"></div></div>
        <div id="pageRadios" class="page"><div class="page-content" id="radiosContent"></div></div>
        <div id="pagePanique" class="page"><div class="page-content" id="paniqueContent"></div></div>
        <div id="pageHabillement" class="page"><div class="page-content" id="habillementContent"></div></div>
        <div id="pageAvertissements" class="page"><div class="page-content" id="avertissementsContent"></div></div>
        <div id="pageConges" class="page"><div class="page-content" id="congesContent"></div></div>
        <div id="pageOutils" class="page"><div class="page-content" id="outilsContent"></div></div>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-info">
            <span id="dbInfo">Base: Chargement...</span>
            <span id="syncStatus">âš¡ En ligne</span>
        </div>
        <div class="footer-version">SGA PWA v1.0 | Â© 2024</div>
    </footer>

    <!-- Modal -->
    <div id="modalOverlay" class="modal-overlay" style="display:none"></div>
    <div id="modalContainer" class="modal-container" style="display:none"></div>

    <!-- SystÃ¨me de diagnostic visible -->
    <div id="mobileDebug" style="
        position: fixed;
        bottom: 10px;
        right: 10px;
        background: #e74c3c;
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 99999;
        font-size: 14px;
        display: none;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    ">
        <strong>âš ï¸ ERREUR DETECTÃ‰E</strong>
        <div id="debugMessage"></div>
        <div style="margin-top: 10px;">
            <button onclick="location.reload()" style="
                background: white;
                color: #e74c3c;
                border: none;
                padding: 8px 12px;
                border-radius: 5px;
                margin: 5px;
            ">ğŸ”„ Recharger</button>
            <button onclick="localStorage.clear(); location.reload()" style="
                background: #f39c12;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 5px;
                margin: 5px;
            ">ğŸ§¹ Vider cache</button>
        </div>
    </div>

    <!-- Scripts dans l'ORDRE CORRECT -->
    <script>
        // ==================== FICHIERS MINIMALISTES DIRECTEMENT DANS index.html ====================
        
        // 1. SGA_Database (version simplifiÃ©e pour test)
        class SGA_Database {
            constructor() { console.log('âœ… SGA_Database crÃ©Ã©'); }
            async initialize() { 
                console.log('âœ… DB initialisÃ©e');
                return Promise.resolve();
            }
            async listerAgents() { return []; }
            async obtenirAgent() { return null; }
            async ajouterAgent() { return true; }
        }

        // 2. PlanningEngine (version simplifiÃ©e)
        class PlanningEngine {
            constructor(db) { 
                this.db = db;
                console.log('âœ… PlanningEngine crÃ©Ã©'); 
            }
            async genererPlanningTheorique() { return []; }
        }

        // 3. ExportUtils (version simplifiÃ©e)
        class ExportUtils {
            constructor(db) { 
                this.db = db;
                console.log('âœ… ExportUtils crÃ©Ã©'); 
            }
            setPlanningEngine(engine) { this.planningEngine = engine; }
        }

        // 4. DatabaseManager (wrapper)
        class DatabaseManager extends SGA_Database {
            constructor() {
                super();
                console.log('âœ… DatabaseManager crÃ©Ã©');
            }
        }

        console.log('=== TOUTES LES CLASSES SONT DÃ‰FINIES ===');
    </script>

    <!-- Charger app.js APRÃˆS avoir dÃ©fini les classes -->
    <script src="app.js"></script>

    <!-- Script d'initialisation -->
    <script>
        // VÃ©rifier que app.js a bien chargÃ© SGA_App
        setTimeout(function() {
            console.log('=== VÃ‰RIFICATION FINALE ===');
            
            const classesToCheck = [
                'SGA_Database',
                'DatabaseManager', 
                'PlanningEngine',
                'ExportUtils',
                'SGA_App'
            ];
            
            let allOk = true;
            const missing = [];
            
            classesToCheck.forEach(cls => {
                if (typeof window[cls] === 'undefined') {
                    console.error('âŒ Classe manquante:', cls);
                    missing.push(cls);
                    allOk = false;
                } else {
                    console.log('âœ… Classe disponible:', cls);
                }
            });
            
            if (!allOk) {
                // Afficher l'erreur Ã  l'utilisateur
                const debugDiv = document.getElementById('mobileDebug');
                const messageDiv = document.getElementById('debugMessage');
                
                messageDiv.innerHTML = `
                    <p>Classes manquantes:</p>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        ${missing.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                    <p><small>VÃ©rifiez que tous les fichiers .js sont dans le mÃªme dossier</small></p>
                `;
                debugDiv.style.display = 'block';
                
                // Essayer de charger app.js Ã  nouveau
                console.log('ğŸ”„ Tentative de rechargement de app.js...');
                const script = document.createElement('script');
                script.src = 'app.js';
                script.onload = function() {
                    console.log('âœ… app.js rechargÃ©');
                    location.reload();
                };
                script.onerror = function() {
                    console.error('âŒ Impossible de charger app.js');
                    messageDiv.innerHTML += '<p style="color: yellow;">Erreur: Fichier app.js introuvable</p>';
                };
                document.head.appendChild(script);
            } else {
                console.log('ğŸ‰ TOUTES LES CLASSES SONT DISPONIBLES');
                
                // Initialiser l'application
                if (typeof SGA_App !== 'undefined') {
                    console.log('ğŸš€ Initialisation de SGA_App...');
                    window.sgaApp = new SGA_App();
                    
                    // Rendre disponible globalement pour les boutons HTML
                    window.sgaApp = window.sgaApp;
                    
                    // DÃ©marrer l'application
                    window.sgaApp.initialize().then(() => {
                        console.log('âœ… Application SGA initialisÃ©e avec succÃ¨s');
                        // Masquer le panneau de debug s'il Ã©tait affichÃ©
                        document.getElementById('mobileDebug').style.display = 'none';
                    }).catch(err => {
                        console.error('âŒ Erreur initialisation:', err);
                        const debugDiv = document.getElementById('mobileDebug');
                        const messageDiv = document.getElementById('debugMessage');
                        messageDiv.innerHTML = `<p>Erreur d'initialisation: ${err.message}</p>`;
                        debugDiv.style.display = 'block';
                    });
                } else {
                    console.error('âŒ SGA_App existe mais ne peut pas Ãªtre instanciÃ©');
                }
            }
        }, 500);
    </script>
</body>
</html>